#!/bin/bash
# Скрипт остановки сервера дискотеки ВДНХ

echo "Остановка сервера дискотеки ВДНХ"
echo "================================================"
echo ""

# Переходим в директорию скрипта
cd "$(dirname "$0")"

# Ищем процесс scheduler_server.py
PID=$(ps aux | grep '[s]cheduler_server.py' | awk '{print $2}')

if [ -z "$PID" ]; then
    echo "Сервер не запущен"
    exit 0
fi

echo "Найден процесс сервера (PID: $PID)"
echo "Останавливаем сервер..."

# Останавливаем процесс
kill $PID

# Ждем завершения
sleep 2

# Проверяем, остановился ли процесс
if ps -p $PID > /dev/null 2>&1; then
    echo "Процесс не остановился, принудительная остановка..."
    kill -9 $PID
    sleep 1
fi

# Финальная проверка
if ps -p $PID > /dev/null 2>&1; then
    echo "Не удалось остановить сервер (PID: $PID)"
    exit 1
else
    echo "Сервер успешно остановлен"
fi

echo ""
echo "VPN-соединение оставлено активным"
echo "================================================"

